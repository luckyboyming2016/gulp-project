!function(t){var e=t&&t.pub||(t.pub={});e.inited&&console.warn("repeat invoke pub.js!"),e.start=Date.now(),e.version="0.2",e.remote="http://bdata.mogoroom.com/",e.test="http://192.168.60.212:82/",define(["jquery","analytics/bin","underscore","moment","URL","analytics/dict/page","jquery.cookie"],function(t,i,n,o,s,r){function h(t){t=t||{},this.bin=new i,t.clipper&&(this.clipper=t.clipper),this.pvLogTick=t.pvLogTick||10,this.pageId=t.pageId||this.getPageCode(),this.baseInfo=this.buildBaseInfo(),"/mogoroom-renterpc"==t.context&&(e.remote=e.test)}return h.prototype={day:864e5,hour:36e5,getFormattedDate:function(t){var e=null==t?new Date:new Date(t),i=function(t){return t<10?"0"+t:String(t)};return e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())},getPageCode:function(t){return t=t||location.pathname,this.clipper.forEach(function(e){t=(n.isFunction(e)?e(t):t.replace(e,""))||t}),t},logPV:function(){var t=this.bin.get("pv")||{},e=Date.now();t[this.pageId]?(e-t[this.pageId][0]>1e3*this.pvLogTick&&t[this.pageId].push(e),t[this.pageId][0]=e):t[this.pageId]=[e,e],this.bin.set("pv",t)},logUV:function(){var t=this.bin.get("uv"),e=this.getFormattedDate();t?t[0]!=e&&(t.push(e),t[0]=e,this.bin.set("uv",t)):(t=[e,e],this.bin.set("uv",t))},updateVV:function(){var t=this.bin.get("vv"),e=Date.now();if(t){e-this.bin.get("lastActive")>.5*this.hour&&(t.push(e),this.bin.set("vv",t))}else t=[e],this.bin.set("vv",t);this.bin.set("lastActive",e,!0)},logClick:function(t){this.atomLog(t,"click")},logEnter:function(t){this.atomLog(t,"enter")},atomLog:function(e,i){var n=t.extend({logUrl:location.href,eventType:i,clientPosition:e.pageX+","+e.pageY,logTime:o().format("YYYYMMDDhhmm"),eventCode:e.data.id},this.baseInfo),s=this.bin.get("log")||[];s.push(n),this.bin.set("log",s)},findScroll:function(){var e=[];return t("body,div").each(function(){"auto"==t(this).css("overflowY")&&t(this).height()>300&&e.push(this)}),t(e)},listen:function(){this.pageLog("open"),t(window).on("beforeunload",t.proxy(this.pageLog,this,"close"))},pageLog:function(i){var n=this.bin.get("log")||[],s=t.extend({logUrl:location.href,logTime:o().format("YYYYMMDDhhmm"),eventType:i},this.baseInfo);"close"==i&&(s.residenceTime=Date.now()-e.start),n.push(s),this.bin.set("log",n)},start:function(i){e.inited||(t(t.proxy(this.listen,this)),this.bin.on("push",this.sync,this),this.versionControl(),e.inited=!0),n(i||[]).each(function(e){require(["analytics/dict/"+e],t.proxy(function(t){n.isObject(t.text)&&this.bindByText(t.text),n.isObject(t.selector)&&this.bindBySelector(t.selector),n.isObject(t.enter)&&this.bindEnter(t.enter)},this))},this)},bindByText:function(e){n(e).each(function(e,i){this.belong(e)&&(this.isRepeat(e,i)||t("a:contains('"+i+"')",e.context||document).click(e,t.proxy(this.logClick,this)))},this)},bindBySelector:function(e){n(e).each(function(e,i){this.belong(e)&&(this.isRepeat(e,i)||t(document).on("click",(e.context?e.context+" ":"")+i,e,t.proxy(this.logClick,this)))},this)},bindEnter:function(e){n(e).each(function(e,i){t(document).on("keypress",i,e,t.proxy(function(t){13==t.keyCode&&this.logEnter(t)},this))},this)},isRepeat:function(t,e){t.context&&(e=t.context+" "+e);var i=!!this._pool[e];return this._pool[e]=!0,i},belong:function(t){var e=t.id,i=t.pageId;return!!e&&(i||(i="*"),"*"==i&&(i=this.pageId),n.isArray(i)?i.indexOf(this.page)>-1:i==this.pageId)},_pool:{},sync:function(){var i=this.bin.get("log");this.bin.set("log",[],!0),t.post(e.remote,{log:i},function(){},"json")},clipper:[/;jsessionid=.*$/,/^(\/mogoroom\-([^\/]+))?(\/pages)?/,/\.(.){2,}$/,/^\//],versionControl:function(){var t=this.bin.get("version");t?t!=e.version&&(this.bin.clear(),this.bin.set("version",t,!0)):(t=e.version,this.bin.set("version",t,!0))},buildBaseInfo:function(){var e,i,n={authId:t.cookie("renterid")||"",uid:t.cookie("uid"),sysId:"mogo-renter-pc",referrer:document.referrer,pagexy:t(window).width()+","+t(window).height()};return n.referrer&&(e=new s(n.referrer),i=this.getPageCode(e.pathname),r[i]&&(n.regPageId=r[i])),n.pageId=r[this.pageId],n}},h})}(this);