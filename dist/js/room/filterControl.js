define(["jquery","collection","underscore","BMap"],function(t,n,i){function o(o){o=o||{},null!=o.mark&&(this.mark=o.mark),null!=o.tmpl&&(this.tmpl=o.tmpl),this.collection=new n,this.content=t(i.template(this.tmpl)({list:o.list||[]})),this.content.children().click(t.proxy(this.click,this)),this.on("change",this.change,this),BMap.Control.apply(this,arguments)}o.prototype=Object.create(BMap.Control.prototype);return function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}(o.prototype,{initialize:function(t){t.getContainer().appendChild(this.content[0])},click:function(n){var i=t(n.target).closest("button");return this.collection.trigger("change",t(".fa",i).is(".fa-check")?null:i.val()),this},change:function(t){return this.content.find(".fa").removeClass(this.mark),null!=t&&this.content.find('[value="'+t+'"] .fa').addClass(this.mark),this},on:function(t,n,i){return this.collection.on(t,n,i),this},off:function(t,n){return this.collection.off(t,n),this},hidden:function(){return this.content.css({display:"none"}),this},show:function(){return this.content.css({display:"block"}),this},isMarked:function(n,i){return t(n,i||this.content).is("."+this.mark)},mark:"fa-check",tmpl:'<div class="map-control-filter"><% _.each(list,function(it){%><button type="button" value="<%=it.code%>"><em style="background-color:<%=it.color%>"></em><%=it.name%><i class="fa"></i></button><%});%></div>'}),o});